---
layout: post
title: "NoSQL基础"
author: "Kai"
header-style: text
tags:
  - NoSQL
---

转自：https://juejin.cn/post/7273436664361271351
{% raw %}

# 1. 为什么要用NoSQL
## 1.1 单机单数据库时代
- 网络不发达的时代，一个系统由一台机器，一个数据库来实现，只要流量上来，首先性能瓶颈就是数据库IO。
  ![20241201111511](https://raw.githubusercontent.com/fannkaii/MyPicBed/master/images/20241201111511.png)

## 1.2 Cache+数据库时代
- NoSQL作为一种缓存出现在系统架构中，可以缓解数据库的IO性能瓶颈。
  ![20241201111530](https://raw.githubusercontent.com/fannkaii/MyPicBed/master/images/20241201111530.png)

## 1.3 海量数据时代
- 互联网时代，个人信息爆发式增长，关系型数据库无法胜任如此大量的数据和数据类型。
- NoSQL作为一种专门存储海量数据，各种类型数据（图片，文件，缓存等）的专门存储库出现得到广泛应用，在存储领域占据越来越重要的位置。
- NoSQL+RMDBS各司其职，共同构成现代互联网系统的存储系统。
  ![20241201111559](https://raw.githubusercontent.com/fannkaii/MyPicBed/master/images/20241201111559.png)

# 2. 什么是NoSQL
## 2.1 NoSQL
- NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。
- NoSQL用于超大规模数据的存储。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。

## 2.2 NoSQL 简史
- NoSQL一词最早出现于1998年，是Carlo Strozzi开发的一个轻量、开源、不提供SQL功能的关系数据库。
- 2009年，Last.fm的Johan Oskarsson发起了一次关于分布式开源数据库的讨论[2]，来自Rackspace的Eric Evans再次提出了NoSQL的概念，这时的NoSQL主要指非关系型、分布式、不提供ACID的数据库设计模式。
- 2009年在亚特兰大举行的"no:sql(east)"讨论会是一个里程碑，其口号是"`select fun, profit from real_world where relational=false;`"。因此，对NoSQL最普遍的解释是"非关联型的"，强调Key-Value Stores和文档数据库的优点，而不是单纯的反对RDBMS。

## 2.3 NoSQL的优点/缺点
- 优点:
  - 高可扩展性
  - 分布式计算
  - 低成本
  - 架构的灵活性，半结构化数据
  - 没有复杂的关系

- 缺点:
  - 没有标准化
  - 有限的查询功能（到目前为止）
  - 最终一致是不直观的程序

## 2.4 NoSQL和RDBMS对比
- NoSQL特点
  - 部署成本：nosql数据库易部署，基本都是开源软件，不需要像使用oracle那样花费大量成本购买使用。
  - 查询速度：nosql将数据存储于内存之中，关系型数据库将数据存储在硬盘中，读写速度更快。
  - 存储格式：nosql的存储格式是key,value形式、文档形式、图片形式等等，所以可以存储基础类型以及对象或者是集合等各种格式，而数据库则只支持基础类型。
  - 扩展性：nosql数据结构丰富，扩展简单，关系型数据库需要按照规则定义表，列。

- RDBMS特点
  - 学习成本：关系型数据库有专门的SQL查询标准，不同数据库之间差异小，学习了一个关系型数据库之后再学习其他数据库相对简单，NoSQL没有类似SQL的查询标准语言，不同的NoSQL都不一样，学习难度大一些。
  - 事务：关系型数据库支持事务，可以存储对数据操作要求高的数据，NoSQL不支持事务，只能存储要求低一些的数据。
  - 没法实现多表关联的复杂数据查询。

- RDBMS和NoSQL关系
  - 两者并非对立而是互补的关系，各自实现其功能和价值。

# 3. BASE理论
## 3.1 分布式系统
- **什么是分布式系统**
  - 分布式系统（distributed system）由多台计算机和通信的软件组件通过计算机网络连接（本地网络或广域网）组成。
  - 分布式系统是建立在网络之上的软件系统。正是因为软件的特性，所以分布式系统具有高度的内聚性和透明性。
  - 分布式系统可以应用在在不同的平台上如：Pc、工作站、局域网和广域网上等。

- **分布式计算的优点**
  - **可靠性（容错）**：分布式计算系统中的一个重要的优点是可靠性。一台服务器的系统崩溃并不影响到其余的服务器。
  - **可扩展性**：在分布式计算系统可以根据需要增加更多的机器。
  - **资源共享**：共享数据是必不可少的应用，如银行，预订系统。
  - **灵活性**：由于该系统是非常灵活的，它很容易安装，实施和调试新的服务。
  - **更快的速度**：分布式计算系统可以有多台计算机的计算能力，使得它比其他系统有更快的处理速度。
  - **开放系统**：由于它是开放的系统，本地或者远程都可以访问到该服务。
  - **更高的性能**：相较于集中式计算机网络集群可以提供更高的性能（及更好的性价比）。

- **分布式计算的缺点**
  - **故障排除**：故障排除和诊断问题。
  - **软件**：更少的软件支持是分布式计算系统的主要缺点。
  - **网络**：网络基础设施的问题，包括：传输问题，高负载，信息丢失等。
  - **安全性**：开发系统的特性让分布式计算系统存在着数据的安全性和共享的风险等问题。

## 3.2 CAP理论
- 在计算机科学中, CAP定理（CAP theorem）, 又被称作布鲁尔定理（Brewer's theorem）, 它指出对于一个分布式计算系统来说，不可能同时满足以下三点:
  - **一致性(Consistency)** (所有节点在同一时间具有相同的数据)
  - **可用性(Availability)** (保证每个请求不管成功或者失败都有响应)
  - **分隔容忍(Partition tolerance)** (系统中任意信息的丢失或失败不会影响系统的继续运作)

- CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，最多只能同时较好的满足两个。
- 因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三 大类：
  - CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。
  - CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。
  - AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。

## 3.3 BASE理论
- BASE理论是一种基于CAP定理逐步演化而来的理论，它认为在分布式系统中，我们可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性。
- BASE理论主要包括以下三个核心概念：
  1. **基本可用（Basically Available）**：分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用。比如，电商网站交易付款出现问题，商品依然可以正常浏览。
  2. **软状态（Soft state）**：由于不要求强一致性，所以BASE允许系统中存在中间状态（也叫软状态），这个状态不影响系统可用性。例如订单的"支付中"、“数据同步中”等状态，待数据最终一致后状态改为“成功”状态。
  3. **最终一致（Eventually consistent）**：最终一致是指经过一段时间后，所有节点数据都将会达到一致。比如订单的"支付中"状态，最终会变为“支付成功”或者"支付失败"，使订单状态与实际交易结果达成一致，但需要一定时间的延迟、等待。

- 满足BASE理论的事务，我们称之为“柔性事务”。

## 3.4 关系型数据库事务ACID规则
- Atomicity(原子性)：要么都成功，要么都失败。
- Consistency(一致性)：一个事务在执行之前和执行之后，数据库都必须处以一致性状态。
- Isolation(隔离性)：在并发环境中，并发的事务是互相隔离的，一个事务的执行不能被其它事务干扰。
- Durability (持久性)：事务的持久性是指事务一旦提交后，数据库中的数据必须被永久的保存下来。

## 3.5 ACID vs BASE

| ACID                    | BASE                                  |
| ----------------------- | ------------------------------------- |
| 原子性(**A**tomicity)   | 基本可用(**B**asically **A**vailable) |
| 一致性(**C**onsistency) | 软状态/柔性事务(**S**oft state)       |
| 隔离性(**I**solation)   | 最终一致性 (**E**ventual consistency) |
| 持久性 (**D**urable)    |                                       |

# 4. 常见NoSQL数据库

| 类型          | 部分代表                                               | 特点                                                                                                                                 |
| ------------- | ------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------ |
| 列存储        | Hbase，Cassandra，Hypertable                           | 顾名思义，是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。 |
| 文档存储      | MongoDB，CouchDB                                       | 文档存储一般用类似json的格式存储，存储的内容是文档型的。这样也就有有机会对某些字段建立索引，实现关系数据库的某些功能。               |
| key-value存储 | Tokyo Cabinet / Tyrant，Berkeley DB，MemcacheDB，Redis | 可以通过key快速查询到其value。一般来说，存储不管value的格式，照单全收。（Redis包含了其他功能）                                       |
| 图存储        | Neo4J，FlockDB                                         | 图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且设计使用不方便。                                                       |
| 对象存储      | db4o，Versant                                          | 通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。                                                                       |
| xml数据库     | Berkeley DB XML，BaseX                                 | 高效的存储XML数据，并支持XML的内部查询语法，比如XQuery,Xpath。                                                                       |

{% endraw %}